<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tablero de Organización del Colectivo ALTER.IAS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --green-board: #388E3C;
            --blue-grey-board: #546E7A;
            --white-lines: #F5F5F5;
            --yellow-note: #FFEB3B;
            --red-note: #EF5350;
            --light-blue-note: #A7D9FF;
            --note-shadow-color: #21215B;
            --delete-button-bg: #D32F2F;
            --delete-button-hover: #F44336;
            --add-button-bg: #4CAF50;
            --add-button-hover: #45a049;
            --select-bg: #f8f8f8;
            --select-border: #ccc;
            --dark-background: #2C3E50;
            --text-on-dark: #ECF0F1;
            --title-color: #BDC3C7;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--dark-background);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            font-family: 'Fredoka', sans-serif;
            overflow-y: auto;
            padding-top: 20px;
            padding-bottom: 20px;
            color: var(--text-on-dark);
        }

        .main-header {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--text-on-dark);
            margin-bottom: 40px;
            text-align: center;
            padding: 0 20px;
            max-width: 1200px;
        }

        .board-section {
            width: 90%;
            max-width: 1200px;
            margin-bottom: 50px;
        }

        .board-section h2 {
            font-size: 2em;
            color: var(--title-color);
            margin-bottom: 20px;
            text-align: left;
            padding-left: 10px;
        }

        .kanban-board-container {
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
            overflow: hidden;
        }

        .kanban-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: auto auto 1fr; /* Encabezados, Controles, Contenido */
            color: var(--white-lines);
        }

        .kanban-board.internal-theme { background-color: var(--green-board); }
        .kanban-board.projects-theme { background-color: var(--blue-grey-board); }

        .kanban-cell { /* Estilo base para todas las celdas del grid */
            padding: 15px;
            text-align: center;
            box-sizing: border-box;
            border-right: 2px solid var(--white-lines);
            border-bottom: 2px solid var(--white-lines);
        }

        /* Quitar borde derecho de la última celda de cada fila */
        .kanban-board > .kanban-cell:nth-child(5n) { border-right: none; }

        /* Quitar borde inferior de la última fila de celdas (la de contenido) */
        .kanban-board > .kanban-cell.kanban-content { border-bottom: none; }
        /* Y también de las celdas vacías de control en la última fila lógica de 'celdas visibles' (fila 2) */
         .kanban-board > .add-task-controls-wrapper:nth-child(n+6):nth-child(-n+10), /* Para internal y projects theme */
         .kanban-board > .empty-control-cell:nth-child(n+6):nth-child(-n+10) {
            /* No aplica porque el contenido está en la fila 3. El borde inferior de la fila 2 ya está bien. */
        }
         /* Borde inferior de la última fila de celdas (la de contenido) */
        .kanban-board > .kanban-cell:nth-child(n+11) { border-bottom: none; }


        .kanban-header {
            grid-row: 1;
            font-size: 1.3em;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-task-controls-wrapper {
            grid-row: 2;
            grid-column: 1; /* Controles siempre en la primera columna de la segunda fila */
            /* Hereda estilos de .kanban-cell para bordes y padding */
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            justify-content: center;
            background-color: inherit; /* Para que coincida con el fondo del tablero */
        }

        .empty-control-cell {
            grid-row: 2; /* También en la segunda fila */
            background-color: inherit; /* Para que coincida con el fondo del tablero */
             /* Hereda estilos de .kanban-cell para bordes y padding */
        }

        .kanban-content {
            grid-row: 3; /* Contenido siempre en la tercera fila */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
            min-height: 150px;
            flex-grow: 1;
            /* padding ya viene de .kanban-cell */
            position: relative;
        }

        /* SELECTOR DE PRIORIDAD (CSS que funcionaba) */
        .priority-select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--select-border);
            border-radius: 5px;
            background-color: var(--select-bg);
            font-family: 'Fredoka', sans-serif;
            font-size: 0.9em;
            color: #333;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23000%22%20d%3D%22M287%2C114.7L158.4%2C243.3c-2.8%2C2.8-6%2C4.3-9.5%2C4.3s-6.7-1.5-9.5-4.3L5.4%2C114.7c-5.6-5.6-5.6-14.1%2C0-19.6s14.1-5.6%2C19.6%2C0l133.7%2C133.7l133.7-133.7c5.6-5.6%2C14.1-5.6%2C19.6%2C0s5.6%2C14.1%2C0%2C19.6L287%2C114.7z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 12px;
            cursor: pointer;
            z-index: 1;
            position: relative;
        }
        .priority-select:focus {
            outline: 2px solid var(--add-button-bg);
            outline-offset: 1px;
        }

        .add-note-button {
            background-color: var(--add-button-bg);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .add-note-button:hover { background-color: var(--add-button-hover); }

        .sticky-note {
            width: 120px;
            height: 120px;
            position: relative;
            cursor: grab;
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
            box-shadow: 4px 4px 0px 0px var(--note-shadow-color),
                        2px 2px 5px rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            box-sizing: border-box;
            word-wrap: break-word;
            font-size: 0.9em;
            line-height: 1.3;
        }
        .sticky-note:active {
            cursor: grabbing;
            transform: scale(1.05) !important;
            z-index: 100;
            box-shadow: 6px 6px 0px 0px var(--note-shadow-color),
                        4px 4px 8px rgba(0, 0, 0, 0.4);
        }
        .sticky-note.yellow { background-color: var(--yellow-note); }
        .sticky-note.red { background-color: var(--red-note); }
        .sticky-note.light-blue {
            background-color: var(--light-blue-note);
            color: #444;
        }
        .sticky-note.yellow .note-content { color: black; }

        .note-content {
            flex-grow: 1;
            text-align: left;
            color: inherit;
            outline: none;
            cursor: text;
            max-height: 75px;
            overflow-y: auto;
            margin-bottom: 5px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .note-content[contenteditable="true"]:empty:before {
            content: attr(data-placeholder);
            color: #888;
            pointer-events: none;
        }

        .delete-button {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: var(--delete-button-bg);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, background-color 0.2s ease-in-out;
            z-index: 10;
        }
        .sticky-note:hover .delete-button { opacity: 1; }
        .delete-button:hover {
            background-color: var(--delete-button-hover);
            transform: scale(1.1);
        }

        .rotate-0 { transform: rotate(0deg); }
        .rotate-1 { transform: rotate(2deg); }
        .rotate-2 { transform: rotate(-3deg); }
        .rotate-3 { transform: rotate(1deg); }
        .rotate-4 { transform: rotate(-1deg); }
        .rotate-5 { transform: rotate(4deg); }
        .rotate-6 { transform: rotate(-2.5deg); }
        .rotate-7 { transform: rotate(3.5deg); }
        .rotate-8 { transform: rotate(-1.5deg); }
        .rotate-9 { transform: rotate(2.8deg); }

        .sortable-ghost {
            opacity: 0.2;
            background-color: var(--white-lines) !important;
            border: 2px dashed var(--note-shadow-color);
        }
        .sortable-drag { opacity: 1; }

        @media (max-width: 768px) {
            .main-header { font-size: 2em; margin-bottom: 30px; }
            .board-section h2 { font-size: 1.7em; margin-bottom: 15px; }
            .kanban-board {
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: auto;
            }
            .kanban-board > .kanban-header,
            .kanban-board > .add-task-controls-wrapper,
            .kanban-board > .empty-control-cell,
            .kanban-board > .kanban-content {
                grid-row: unset !important;
                grid-column: unset !important;
            }
            .kanban-board > .kanban-cell:nth-child(3n) { border-right: none; }
            .kanban-board > .kanban-cell:nth-last-child(-n+3) { border-bottom: none; }

            .add-task-controls-wrapper { grid-column: 1 / span 1 !important; }
            .empty-control-cell:not(:first-of-type) { display: none; }


            .kanban-header { font-size: 1.1em; padding: 15px 10px;}
            .sticky-note { width: 100px; height: 100px; padding: 8px;}
            .note-content { max-height: 60px;}
            .delete-button { width: 18px; height: 18px; font-size: 0.7em;}
            .add-task-controls-wrapper { max-width: 120px; }
        }

        @media (max-width: 480px) {
            .main-header { font-size: 1.5em; margin-bottom: 20px; }
            .board-section h2 { font-size: 1.4em; margin-bottom: 10px; }
            .kanban-board {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }
            .kanban-cell {
                border-right: none !important;
                border-bottom: 2px solid var(--white-lines);
            }
            .kanban-board > .kanban-cell:last-child { border-bottom: none; }
            .add-task-controls-wrapper, .empty-control-cell { display: block; grid-column: 1 / -1 !important; }


            .kanban-header { font-size: 1em; padding: 10px; }
            .sticky-note { width: 90px; height: 90px; margin: 5px; padding: 6px;}
            .note-content { max-height: 50px; font-size: 0.8em; }
            .delete-button { width: 16px; height: 16px; font-size: 0.6em;}
            .add-task-controls-wrapper { max-width: 100%; }
            .priority-select { font-size: 0.8em; padding: 6px;}
            .add-note-button { font-size: 0.9em; padding: 8px;}
        }
    </style>
</head>
<body>
    <header class="main-header">
        <h1>TABLERO DE ORGANIZACIÓN DEL COLECTIVO ALTER.IAS</h1>
    </header>

    <!-- Tablero de Organización Interna -->
    <div class="board-section">
        <h2>Organización Interna</h2>
        <div class="kanban-board-container">
            <div class="kanban-board internal-theme">
                <div class="kanban-cell kanban-header">Lista de Pendientes</div>
                <div class="kanban-cell kanban-header">Historias</div>
                <div class="kanban-cell kanban-header">Por Hacer</div>
                <div class="kanban-cell kanban-header">En Curso</div>
                <div class="kanban-cell kanban-header">Completado</div>

                <div class="kanban-cell add-task-controls-wrapper" data-column-target="backlog-internal">
                    <select class="priority-select">
                        <option value="yellow">Importante</option>
                        <option value="red">Urgente</option>
                        <option value="light-blue">No Importante</option>
                    </select>
                    <button class="add-note-button">Añadir Tarea</button>
                </div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>

                <div class="kanban-cell kanban-content" data-column-id="backlog-internal"></div>
                <div class="kanban-cell kanban-content" data-column-id="story-internal"></div>
                <div class="kanban-cell kanban-content" data-column-id="todo-internal"></div>
                <div class="kanban-cell kanban-content" data-column-id="doing-internal"></div>
                <div class="kanban-cell kanban-content" data-column-id="done-internal"></div>
            </div>
        </div>
    </div>

    <!-- Tablero de Proyectos: Animaciones -->
    <div class="board-section">
        <h2>Proyectos: Animaciones</h2>
        <div class="kanban-board-container">
            <div class="kanban-board projects-theme">
                 <div class="kanban-cell kanban-header">Lista de Pendientes</div>
                <div class="kanban-cell kanban-header">Historias</div>
                <div class="kanban-cell kanban-header">Por Hacer</div>
                <div class="kanban-cell kanban-header">En Curso</div>
                <div class="kanban-cell kanban-header">Completado</div>

                <div class="kanban-cell add-task-controls-wrapper" data-column-target="backlog-animations">
                    <select class="priority-select">
                        <option value="yellow">Importante</option>
                        <option value="red">Urgente</option>
                        <option value="light-blue">No Importante</option>
                    </select>
                    <button class="add-note-button">Añadir Tarea</button>
                </div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>

                <div class="kanban-cell kanban-content" data-column-id="backlog-animations"></div>
                <div class="kanban-cell kanban-content" data-column-id="story-animations"></div>
                <div class="kanban-cell kanban-content" data-column-id="todo-animations"></div>
                <div class="kanban-cell kanban-content" data-column-id="doing-animations"></div>
                <div class="kanban-cell kanban-content" data-column-id="done-animations"></div>
            </div>
        </div>
    </div>

    <!-- Tablero de Proyectos: Páginas Web -->
    <div class="board-section">
        <h2>Proyectos: Páginas Web</h2>
        <div class="kanban-board-container">
            <div class="kanban-board projects-theme">
                <div class="kanban-cell kanban-header">Lista de Pendientes</div>
                <div class="kanban-cell kanban-header">Historias</div>
                <div class="kanban-cell kanban-header">Por Hacer</div>
                <div class="kanban-cell kanban-header">En Curso</div>
                <div class="kanban-cell kanban-header">Completado</div>

                <div class="kanban-cell add-task-controls-wrapper" data-column-target="backlog-webpages">
                    <select class="priority-select">
                        <option value="yellow">Importante</option>
                        <option value="red">Urgente</option>
                        <option value="light-blue">No Importante</option>
                    </select>
                    <button class="add-note-button">Añadir Tarea</button>
                </div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>

                <div class="kanban-cell kanban-content" data-column-id="backlog-webpages"></div>
                <div class="kanban-cell kanban-content" data-column-id="story-webpages"></div>
                <div class="kanban-cell kanban-content" data-column-id="todo-webpages"></div>
                <div class="kanban-cell kanban-content" data-column-id="doing-webpages"></div>
                <div class="kanban-cell kanban-content" data-column-id="done-webpages"></div>
            </div>
        </div>
    </div>

    <!-- Tablero de Proyectos: Agentes AI -->
    <div class="board-section">
        <h2>Proyectos: Agentes AI</h2>
        <div class="kanban-board-container">
            <div class="kanban-board projects-theme">
                <div class="kanban-cell kanban-header">Lista de Pendientes</div>
                <div class="kanban-cell kanban-header">Historias</div>
                <div class="kanban-cell kanban-header">Por Hacer</div>
                <div class="kanban-cell kanban-header">En Curso</div>
                <div class="kanban-cell kanban-header">Completado</div>

                <div class="kanban-cell add-task-controls-wrapper" data-column-target="backlog-aiagents">
                    <select class="priority-select">
                        <option value="yellow">Importante</option>
                        <option value="red">Urgente</option>
                        <option value="light-blue">No Importante</option>
                    </select>
                    <button class="add-note-button">Añadir Tarea</button>
                </div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>
                <div class="kanban-cell empty-control-cell"></div>

                <div class="kanban-cell kanban-content" data-column-id="backlog-aiagents"></div>
                <div class="kanban-cell kanban-content" data-column-id="story-aiagents"></div>
                <div class="kanban-cell kanban-content" data-column-id="todo-aiagents"></div>
                <div class="kanban-cell kanban-content" data-column-id="doing-aiagents"></div>
                <div class="kanban-cell kanban-content" data-column-id="done-aiagents"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const LOCAL_STORAGE_KEY = 'kanbanBoardState_ALTERIAS_v4'; // Nueva clave para asegurar limpieza

            const rotationClasses = ['rotate-0', 'rotate-1', 'rotate-2', 'rotate-3', 'rotate-4', 'rotate-5', 'rotate-6', 'rotate-7', 'rotate-8', 'rotate-9'];

            function getRandomRotationClass() {
                return rotationClasses[Math.floor(Math.random() * rotationClasses.length)];
            }

            function saveBoardState() {
                const boardState = {};
                document.querySelectorAll('.kanban-board').forEach(board => {
                    board.querySelectorAll('.kanban-content').forEach(column => {
                        const columnId = column.dataset.columnId;
                        if (!columnId) return;

                        boardState[columnId] = [];
                        column.querySelectorAll('.sticky-note').forEach(noteElement => {
                            const text = noteElement.querySelector('.note-content').innerText;
                            let color = 'yellow';
                            if (noteElement.classList.contains('red')) color = 'red';
                            else if (noteElement.classList.contains('light-blue')) color = 'light-blue';
                            else if (noteElement.classList.contains('yellow')) color = 'yellow';
                            boardState[columnId].push({ text, color });
                        });
                    });
                });
                try {
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(boardState));
                } catch (e) {
                    console.error("Error al guardar en localStorage:", e);
                }
            }

            function createStickyNote(text = '', color = 'yellow', isInitialLoad = false) {
                const note = document.createElement('div');
                note.classList.add('sticky-note', color, getRandomRotationClass());
                const content = document.createElement('div');
                content.classList.add('note-content');
                content.setAttribute('contenteditable', 'true');
                content.setAttribute('data-placeholder', 'Escribe aquí...');
                content.innerText = text;
                if (text === '' && !isInitialLoad) { setTimeout(() => content.focus(), 0); }

                content.addEventListener('blur', saveBoardState);
                content.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        content.blur();
                    }
                });

                const deleteButton = document.createElement('button');
                deleteButton.classList.add('delete-button');
                deleteButton.innerText = 'X';
                deleteButton.setAttribute('aria-label', 'Eliminar nota');
                deleteButton.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (confirm('¿Estás seguro de que quieres eliminar esta nota?')) {
                        note.remove();
                        saveBoardState();
                    }
                });
                note.appendChild(deleteButton);
                note.appendChild(content);
                return note;
            }

            const kanbanContentColumns = document.querySelectorAll('.kanban-content');
            kanbanContentColumns.forEach(column => {
                if (!column.dataset.columnId) return;
                new Sortable(column, {
                    group: 'kanban-notes',
                    animation: 150,
                    handle: '.sticky-note',
                    filter: '.delete-button', // Solo filtrar el botón de borrar para el arrastre
                    ghostClass: 'sortable-ghost',
                    dragClass: 'sortable-drag',
                    forceFallback: true,
                    fallbackOnBody: true,
                    swapThreshold: 0.65,
                    onEnd: function (evt) {
                        saveBoardState();
                    }
                });
            });

            function loadBoardState() {
                try {
                    const savedStateJSON = localStorage.getItem(LOCAL_STORAGE_KEY);
                    if (savedStateJSON) {
                        const boardData = JSON.parse(savedStateJSON);
                        document.querySelectorAll('.kanban-content .sticky-note').forEach(note => note.remove()); // Limpiar notas existentes
                        Object.keys(boardData).forEach(columnId => {
                            const columnElement = document.querySelector(`.kanban-content[data-column-id="${columnId}"]`);
                            if (columnElement) {
                                const notesForColumn = boardData[columnId];
                                notesForColumn.forEach(noteData => {
                                    const newNote = createStickyNote(noteData.text, noteData.color, true);
                                    columnElement.appendChild(newNote);
                                });
                            }
                        });
                        return true;
                    }
                } catch (e) {
                    console.error("Error al cargar desde localStorage:", e);
                }
                return false;
            }

            function populateBoard(notesConfig) {
                 notesConfig.forEach(config => {
                    const column = document.querySelector(`.kanban-content[data-column-id="${config.columnId}"]`);
                    if (column) {
                        config.notes.forEach(note => {
                            column.appendChild(createStickyNote(note.text, note.color, true));
                        });
                    }
                });
            }

            const internalNotes = [
                { columnId: "backlog-internal", notes: [{ text: 'Planificar reunión semanal', color: 'yellow' }, { text: 'Revisar informes de gastos', color: 'red' }, { text: 'Actualizar manual de bienvenida', color: 'light-blue' }] },
                { columnId: "story-internal", notes: [{ text: 'Como miembro, quiero un sistema de votación', color: 'red' }, { text: 'Como líder, quiero ver el progreso del equipo', color: 'yellow' }] },
                { columnId: "todo-internal", notes: [{ text: 'Preparar agenda reunión próxima', color: 'yellow' }, { text: 'Recopilar feedback de encuestas', color: 'light-blue' }] },
                { columnId: "doing-internal", notes: [{ text: 'Redactar comunicado interno', color: 'yellow' }, { text: 'Organizar archivo de documentos', color: 'red' }] },
                { columnId: "done-internal", notes: [{ text: 'Reunión de planificación completada', color: 'yellow' }, { text: 'Base de datos de contactos actualizada', color: 'red' }] }
            ];
            const animationsNotes = [
                { columnId: "backlog-animations", notes: [{ text: 'Nueva idea para corto animado', color: 'yellow' }, { text: 'Investigar software de render', color: 'light-blue' }] },
                { columnId: "story-animations", notes: [{ text: 'Como cliente, quiero una intro animada para mi marca', color: 'red' }] },
                { columnId: "todo-animations", notes: [{ text: 'Bocetar personajes 3D', color: 'yellow' }] },
                { columnId: "doing-animations", notes: [{ text: 'Renderizando escena final', color: 'yellow' }] },
                { columnId: "done-animations", notes: [{ text: 'Animación de logotipo completada', color: 'yellow' }] }
            ];
            const webpagesNotes = [
                 { columnId: "backlog-webpages", notes: [{ text: 'Investigar framework JS para web', color: 'red'}] },
                 { columnId: "story-webpages", notes: [{ text: 'Como cliente, quiero una web que muestre mi portfolio', color: 'yellow' }] },
                 { columnId: "todo-webpages", notes: [{ text: 'Bocetar diseño de homepage', color: 'yellow' }] },
                 { columnId: "doing-webpages", notes: [{ text: 'Codificar módulo de búsqueda web', color: 'red' }] },
                 { columnId: "done-webpages", notes: [{ text: 'Wireframes web aprobados', color: 'yellow' }] }
            ];
            const aiAgentsNotes = [
                { columnId: "backlog-aiagents", notes: [{ text: 'Explorar APIs de generación de texto', color: 'yellow' }, { text: 'Como usuario, quiero un chatbot que responda preguntas frecuentes', color: 'yellow' }] },
                { columnId: "story-aiagents", notes: [] },
                { columnId: "todo-aiagents", notes: [{ text: 'Definir alcance del chatbot', color: 'light-blue' }] },
                { columnId: "doing-aiagents", notes: [{ text: 'Entrenar modelo de NLU', color: 'yellow' }] },
                { columnId: "done-aiagents", notes: [{ text: 'Diseño de diálogo para bot de ventas', color: 'red' }] }
            ];

            if (!loadBoardState()) {
                console.log("No hay estado guardado, poblando tableros por defecto.");
                populateBoard(internalNotes);
                populateBoard(animationsNotes);
                populateBoard(webpagesNotes);
                populateBoard(aiAgentsNotes);
                saveBoardState();
            }

            document.querySelectorAll('.add-note-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const addControlsWrapper = e.target.closest('.add-task-controls-wrapper');
                    if (!addControlsWrapper) return;
                    const targetColumnId = addControlsWrapper.dataset.columnTarget;
                    const prioritySelect = addControlsWrapper.querySelector('.priority-select');
                    const noteColor = prioritySelect ? prioritySelect.value : 'yellow';
                    const targetColumn = document.querySelector(`.kanban-content[data-column-id="${targetColumnId}"]`);
                    if (targetColumn) {
                        const newNote = createStickyNote('', noteColor, false);
                        targetColumn.appendChild(newNote); // Siempre añadir al final de la columna de contenido
                        newNote.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                        saveBoardState();
                    }
                });
            });
        });
    </script>
</body>
</html>
