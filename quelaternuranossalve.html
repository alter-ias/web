<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Que la ternura nos salve</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Lora:wght@500&family=Roboto+Mono&family=Work+Sans:wght@300;400&display=swap');
        :root {
            --color-fondo: rgb(22, 24, 28); --color-texto: rgb(230, 230, 230);
            --color-acento: rgb(190, 225, 218);
            --font-titulos: 'Lora', serif; --font-cuerpo: 'Work Sans', sans-serif; --font-mono: 'Roboto Mono', monospace;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-cuerpo); background-color: var(--color-fondo); color: var(--color-texto); overflow-x: hidden; }

        .fixed-hero-container { position: fixed; top: 0; left: 0; width: 100%; height: 100vh; z-index: 1; }
        #canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: move; }
        .hero-header { position: absolute; top: 25%; left: 50%; transform: translate(-50%, -50%); width: 100%; padding: 2rem; text-align: center; pointer-events: none; z-index: 2; }
        .hero-description { position: absolute; bottom: 5%; left: 50%; transform: translateX(-50%); width: 100%; max-width: 700px; padding: 2rem; text-align: center; pointer-events: none; z-index: 2; }
        .scroll-container { position: relative; z-index: 3; }
        .scroll-spacer { height: 100vh; }
        .content-block { padding: 4rem 2rem; max-width: 700px; margin: 0 auto; background-color: var(--color-fondo); min-height: 100vh; }

        .dual-column-block { display: flex; align-items: center; gap: 2rem; }
        .model-column, .text-column { flex: 1; }
        .model-container { width: 100%; height: 60vh; border-radius: 8px; background-color: rgba(0,0,0,0.2); }
        .model-canvas-ramona { width: 100%; height: 100%; border-radius: 8px; cursor: grab; }
        
        .music-player { margin-top: 1.5rem; }
        .music-player audio { width: 100%; }
        audio::-webkit-media-controls-panel { background-color: rgba(255, 255, 255, 0.1); }
        audio::-webkit-media-controls-play-button { color: var(--color-acento); }
        
        h1 { font-family: var(--font-titulos); font-size: 3rem; margin-bottom: 1rem; }
        /* CORRECCIÓN: Regla de CSS para el subtítulo restaurada */
        h1 span { font-family: var(--font-mono); font-size: 1rem; display: block; margin-top: 10px; color: var(--color-acento); }
        h3 { font-family: var(--font-titulos); font-size: 1.5rem; color: var(--color-acento); margin-bottom: 1rem; }
        p { line-height: 1.8; margin-bottom: 1.5rem; }
        
        @media (max-width: 768px) {
            h1 { font-size: 2.2rem; }
            .hero-header { top: 18%; }
            .hero-description { bottom: 2%; font-size: 0.9rem; max-width: 90%; }
            .dual-column-block { flex-direction: column; }
            .model-container { height: 40vh; margin-bottom: 2rem; }
        }
    </style>
</head>
<body>

    <div class="fixed-hero-container">
        <div id="canvas-container"></div>
        <header class="hero-header">
            <!-- TÍTULO Y SUBTÍTULO CORREGIDOS -->
            <h1>Que la ternura nos salve<span>Un manifiesto que florece entre el artificio y el oficio</span></h1>
        </header>
        <section class="hero-description">
            <p>Este es un mensaje en una botella, arrojado al vasto océano digital. Un experimento que mezcla escritos, música, dibujos y animaciones. Todo está permitido aquí, conectado por hilos invisibles que forman una única obra de arte digital. Un recordatorio de que en la creación deliberada y en la vulnerabilidad, encontramos una forma de salvación.</p>
        </section>
    </div>

    <main class="scroll-container">
        <div class="scroll-spacer"></div>
        <section class="content-block">
            <div class="dual-column-block">
                <div class="model-column">
                    <div class="model-container">
                        <canvas class="model-canvas-ramona"></canvas>
                    </div>
                </div>
                <div class="text-column">
                    <h3>Ramona, Tema I</h3>
                    <p>Aquí puedes escribir la historia detrás de la pieza, las emociones que la inspiraron, o cualquier texto que acompañe a la música y al arte visual.</p>
                    <div class="music-player">
                        <audio controls src="assets/music/ramona_theme.mp3">
                            Tu navegador no soporta el elemento de audio.
                        </audio>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.163.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.163.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // =================================================================
        // ESCENA 1: HERO FIJO (MÁQUINA DE ESCRIBIR)
        // =================================================================
        const heroParams = {
            desktopModelScale: 2.9, desktopModelPositionY: 0.2,
            mobileModelScale: 2.0, mobileModelPositionY: 0.7,
            initialRotationY: -1.57, mouseIntensity: 0.51, smoothingFactor: 0.088,
            cameraDistance: 4.4, ambientIntensity: 5.0, directionalIntensity: 4.5,
        };
        const heroContainer = document.getElementById('canvas-container');
        const heroScene = new THREE.Scene();
        const heroCamera = new THREE.PerspectiveCamera(75, heroContainer.clientWidth / heroContainer.clientHeight, 0.1, 1000);
        heroCamera.position.z = heroParams.cameraDistance;

        // CORRECCIÓN: Se crea el renderer y LUEGO se añade su canvas al contenedor
        const heroRenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        heroRenderer.setPixelRatio(window.devicePixelRatio);
        heroRenderer.setSize(heroContainer.clientWidth, heroContainer.clientHeight);
        heroContainer.appendChild(heroRenderer.domElement);

        const heroAmbientLight = new THREE.AmbientLight(0xffffff, heroParams.ambientIntensity);
        heroScene.add(heroAmbientLight);
        const heroDirectionalLight = new THREE.DirectionalLight(0xffffff, heroParams.directionalIntensity);
        heroDirectionalLight.position.set(5, 10, 7.5);
        heroScene.add(heroDirectionalLight);
        let heroModel;
        new GLTFLoader().load('./assets/3d/maquina.glb', (gltf) => {
            heroModel = gltf.scene;
            const box = new THREE.Box3().setFromObject(heroModel);
            heroModel.position.sub(box.getCenter(new THREE.Vector3()));
            updateHeroModelTransform();
            heroScene.add(heroModel);
        });

        // =================================================================
        // ESCENA 2: BLOQUE DE SCROLL (RAMONA)
        // =================================================================
        const ramonaCanvas = document.querySelector('.model-canvas-ramona');
        const ramonaScene = new THREE.Scene();
        const ramonaCamera = new THREE.PerspectiveCamera(75, ramonaCanvas.clientWidth / ramonaCanvas.clientHeight, 0.1, 1000);
        ramonaCamera.position.z = 2.5;
        const ramonaRenderer = new THREE.WebGLRenderer({ canvas: ramonaCanvas, antialias: true, alpha: true });
        ramonaRenderer.setPixelRatio(window.devicePixelRatio);
        ramonaRenderer.setSize(ramonaCanvas.clientWidth, ramonaCanvas.clientHeight);
        const ramonaControls = new OrbitControls(ramonaCamera, ramonaRenderer.domElement);
        ramonaControls.enableDamping = true;
        ramonaControls.enableZoom = false;
        ramonaControls.autoRotate = true;
        ramonaControls.autoRotateSpeed = 0.8;
        const ramonaAmbientLight = new THREE.AmbientLight(0xffffff, 4.0);
        ramonaScene.add(ramonaAmbientLight);
        const ramonaDirectionalLight = new THREE.DirectionalLight(0xffffff, 3.0);
        ramonaDirectionalLight.position.set(2, 5, 3);
        ramonaScene.add(ramonaDirectionalLight);
        new GLTFLoader().load('./assets/3d/ramona.glb', (gltf) => {
            const model = gltf.scene;
            const box = new THREE.Box3().setFromObject(model);
            model.position.sub(box.getCenter(new THREE.Vector3()));
            ramonaScene.add(model);
        });

        // =================================================================
        // LÓGICA GENERAL, ANIMACIÓN Y EVENTOS
        // =================================================================
        let mouseX = 0, mouseY = 0;
        function handlePointerMove(event) {
            let clientX, clientY;
            if (event.touches) { clientX = event.touches[0].clientX; clientY = event.touches[0].clientY; } 
            else { clientX = event.clientX; clientY = event.clientY; }
            mouseX = (clientX / window.innerWidth) * 2 - 1;
            mouseY = -(clientY / window.innerHeight) * 2 + 1;
        }
        window.addEventListener('mousemove', handlePointerMove);
        window.addEventListener('touchstart', handlePointerMove, { passive: true });
        window.addEventListener('touchmove', handlePointerMove, { passive: true });

        function updateHeroModelTransform() {
            if (!heroModel) return;
            const isMobile = window.innerWidth < 768;
            const scale = isMobile ? heroParams.mobileModelScale : heroParams.desktopModelScale;
            heroModel.scale.set(scale, scale, scale);
            heroModel.position.y = isMobile ? heroParams.mobileModelPositionY : heroParams.desktopModelPositionY;
        }
        
        function animate() {
            requestAnimationFrame(animate);
            if (heroModel) {
                const targetRotationY = mouseX * heroParams.mouseIntensity + heroParams.initialRotationY;
                heroModel.rotation.y += (targetRotationY - heroModel.rotation.y) * heroParams.smoothingFactor;
            }
            heroRenderer.render(heroScene, heroCamera);
            ramonaControls.update();
            ramonaRenderer.render(ramonaScene, ramonaCamera);
        }
        
        window.addEventListener('resize', () => {
            heroCamera.aspect = heroContainer.clientWidth / heroContainer.clientHeight;
            heroCamera.updateProjectionMatrix();
            heroRenderer.setSize(heroContainer.clientWidth, heroContainer.clientHeight);
            updateHeroModelTransform();
            ramonaCamera.aspect = ramonaCanvas.clientWidth / ramonaCanvas.clientHeight;
            ramonaCamera.updateProjectionMatrix();
            ramonaRenderer.setSize(ramonaCanvas.clientWidth, ramonaCanvas.clientHeight);
        });
        
        animate();
    </script>
</body>
</html>
