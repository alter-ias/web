<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cerebro 3D Interactivo</title>
    <style>
        :root { --primary: #00f3ff; --secondary: #ff0055; --bg: #050510; --glass: rgba(20, 20, 35, 0.8); }
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg); color: white; }
        
        #canvas-container { width: 100vw; height: 100vh; position: absolute; z-index: 1; }
        
        #ui-layer { position: absolute; width: 100%; height: 100%; z-index: 2; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; }
        
        header { padding: 20px; background: linear-gradient(to bottom, black, transparent); pointer-events: auto; }
        h1 { margin: 0; font-weight: 300; text-transform: uppercase; font-size: 1.5rem; color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .subtitle { font-size: 0.9rem; color: #aaa; }

        /* Panel Lateral */
        .info-panel { 
            position: absolute; right: 20px; top: 15%; width: 320px; 
            background: var(--glass); backdrop-filter: blur(10px); 
            border-left: 3px solid var(--primary); padding: 25px; 
            border-radius: 10px; pointer-events: auto; 
            transition: all 0.4s ease;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .info-card { display: none; animation: slideIn 0.5s ease; }
        .info-card.active { display: block; }
        
        h3 { color: var(--primary); margin-top: 0; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 10px; }
        p { font-size: 0.95rem; line-height: 1.6; color: #eee; }
        .stat-highlight { color: var(--secondary); font-weight: bold; }

        /* Navegación Inferior */
        .nav-bar {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 15px; pointer-events: auto;
            background: rgba(0,0,0,0.5); padding: 10px 20px; border-radius: 30px;
        }

        .nav-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.3);
            color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer;
            transition: all 0.3s; font-size: 0.8rem; text-transform: uppercase;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--primary); border-color: var(--primary);
            color: black; font-weight: bold; box-shadow: 0 0 15px var(--primary);
        }

        #loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--primary); font-size: 1.5rem; z-index: 10; font-weight: 300; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
</head>
<body>

    <div id="loading">Cargando Modelo...</div>
    <div id="canvas-container"></div>

    <div id="ui-layer">
        <header>
            <h1>Neuro-Tech Explorer</h1>
            <p class="subtitle">Visualización Interactiva Cerebral</p>
        </header>

        <div class="info-panel">
            <div id="content-0" class="info-card active">
                <h3>Vista General</h3>
                <p>Bienvenido al modelo interactivo. El cerebro humano contiene más de <span class="stat-highlight">86 mil millones de neuronas</span> conectadas en una red compleja. Usa los botones abajo para explorar sus funciones.</p>
            </div>
            <div id="content-1" class="info-card">
                <h3>Sistema Visual</h3>
                <p>Situado en la parte trasera (Lóbulo Occipital). Procesa formas, colores y movimiento. Ocupa cerca de <span class="stat-highlight">4 a 6 mil millones de neuronas</span> dedicadas exclusivamente a interpretar lo que ves.</p>
            </div>
            <div id="content-2" class="info-card">
                <h3>Control Motor & Cerebelo</h3>
                <p>El Cerebelo (base del cerebro) coordina el equilibrio y la precisión. Aunque pequeño, contiene <span class="stat-highlight">69 mil millones de neuronas</span>, la mayor densidad del sistema nervioso.</p>
            </div>
            <div id="content-3" class="info-card">
                <h3>Lóbulo Frontal & Juicio</h3>
                <p>La zona frontal es responsable de la planificación, el control de impulsos y la personalidad. Es el "CEO" del cerebro, gestionando decisiones complejas.</p>
            </div>
        </div>

        <div class="nav-bar">
            <button class="nav-btn active" onclick="focusSection(0)">General</button>
            <button class="nav-btn" onclick="focusSection(1)">Visión</button>
            <button class="nav-btn" onclick="focusSection(2)">Motor</button>
            <button class="nav-btn" onclick="focusSection(3)">Frontal</button>
        </div>
    </div>

    <script>
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050510, 0.02);

        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 0, 18);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.minDistance = 8;
        controls.maxDistance = 30;

        // --- ILUMINACIÓN ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
        scene.add(ambientLight);

        const mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
        mainLight.position.set(5, 5, 5);
        scene.add(mainLight);

        // --- LUZ DE RESALTADO (LA LINTERNA MÁGICA) ---
        // Esta luz se moverá para iluminar la zona activa
        const spotLight = new THREE.PointLight(0x00f3ff, 2, 15); // Color cian inicial, intensidad 2, distancia 15
        spotLight.position.set(0, 5, 0);
        scene.add(spotLight);
        
        // Helper visual para ver dónde está la luz (opcional, quítalo si molesta)
        // const spotLightHelper = new THREE.PointLightHelper(spotLight, 0.5);
        // scene.add(spotLightHelper);

        // --- CARGAR MODELO ---
        let brainModel = null;
        const loader = new THREE.GLTFLoader();
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.5.6/');
        loader.setDRACOLoader(dracoLoader);

        // *** RUTA ACTUALIZADA ***
        loader.load('models/gltf/brains.glb', (gltf) => {
            brainModel = gltf.scene;
            
            // Ajustes iniciales
            brainModel.scale.set(6, 6, 6); // Ajusta este número según el tamaño real de tu modelo
            brainModel.position.set(0, -2, 0); 
            
            scene.add(brainModel);
            document.getElementById('loading').style.display = 'none';
            
            // Animación de entrada
            new TWEEN.Tween(brainModel.rotation)
                .to({ y: Math.PI * 2 }, 2000)
                .easing(TWEEN.Easing.Cubic.Out)
                .start();

        }, undefined, (e) => console.error(e));

        // --- SISTEMA DE SECCIONES ---
        
        function focusSection(index) {
            // 1. Actualizar Interfaz
            document.querySelectorAll('.info-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`content-${index}`).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.nav-btn')[index].classList.add('active');

            if (!brainModel) return;

            // 2. Definir Posiciones (Target de Luz y Cámara)
            // Aquí ajustamos dónde se pone la "linterna" para iluminar esa zona
            let lightTarget = { x: 0, y: 5, z: 5, color: '#ffffff' }; 
            let camTarget = { x: 0, y: 0, z: 18 };

            switch(index) {
                case 0: // General (Luz blanca neutra arriba)
                    lightTarget = { x: 5, y: 10, z: 5, color: '#ffffff' };
                    camTarget = { x: 0, y: 0, z: 18 };
                    break;
                case 1: // Visión (Occipital - Atrás) -> Luz Roja/Magenta
                    // Movemos la luz atrás
                    lightTarget = { x: 0, y: 0, z: -8, color: '#ff0055' };
                    // Movemos la cámara para ver la parte trasera
                    camTarget = { x: 8, y: 2, z: -10 }; 
                    break;
                case 2: // Motor (Arriba/Centro) -> Luz Amarilla/Naranja
                    lightTarget = { x: 0, y: 8, z: 0, color: '#ffaa00' };
                    camTarget = { x: 0, y: 10, z: 10 };
                    break;
                case 3: // Frontal -> Luz Azul Cian
                    lightTarget = { x: 0, y: 2, z: 8, color: '#00f3ff' };
                    camTarget = { x: -8, y: 2, z: 10 };
                    break;
            }

            // 3. Animar la Luz (Posición y Color)
            new TWEEN.Tween(spotLight.position).to({ x: lightTarget.x, y: lightTarget.y, z: lightTarget.z }, 1000).easing(TWEEN.Easing.Quadratic.Out).start();
            new TWEEN.Tween(new THREE.Color(spotLight.color.getHex())).to(new THREE.Color(lightTarget.color), 1000)
                .onUpdate(c => spotLight.color.set(c))
                .start();

            // 4. Animar la Cámara
            new TWEEN.Tween(camera.position).to({ x: camTarget.x, y: camTarget.y, z: camTarget.z }, 1500).easing(TWEEN.Easing.Cubic.InOut).start();
        }

        // --- BUCLE DE ANIMACIÓN ---
        function animate(time) {
            requestAnimationFrame(animate);
            TWEEN.update(time); // Actualizar animaciones
            controls.update();
            
            // Flotación suave
            if (brainModel) {
                brainModel.position.y = -2 + Math.sin(time * 0.001) * 0.1;
            }
            
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
