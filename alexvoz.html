<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALEX ASSISTANT | V.16.0 WEB</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700&family=Montserrat:wght@400;800;900&display=swap" rel="stylesheet">
    <style>
        /* --- ESTILOS VISUALES --- */
        :root {
            /* Tema por defecto: LUDOVICO (Inspirado en la película) */
            --bg-color: #e6e6e6; 
            --text-main: #111111;
            --text-sub: #666666;
            --accent: #FF6600; 
            --glass-panel: rgba(255, 255, 255, 0.8);
            --border-color: #ccc;
        }

        [data-theme="ultra"] {
            /* Tema Oscuro / Modo Noche */
            --bg-color: #111111; 
            --text-main: #E8E4D9;
            --text-sub: #888888;
            --accent: #FF0000; 
            --glass-panel: rgba(20, 20, 20, 0.8);
            --border-color: #333;
        }

        body {
            margin: 0;
            background: var(--bg-color);
            color: var(--text-main);
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            transition: background 0.5s ease, color 0.5s ease;
        }

        #theme-toggle {
            position: fixed; top: 30px; left: 10%; z-index: 100;
            background: transparent; border: 2px solid var(--text-main); color: var(--text-main);
            padding: 10px 20px; font-family: 'Rajdhani'; font-weight: 700; cursor: pointer;
            text-transform: uppercase; letter-spacing: 2px; font-size: 10px; transition: 0.3s;
        }
        #theme-toggle:hover { background: var(--text-main); color: var(--bg-color); }

        #canvas-container {
            position: fixed; top: 0; right: 0; width: 60%; height: 100vh; z-index: 10;
            /* Máscara suave para integrar con el fondo */
            mask-image: linear-gradient(to right, transparent 0%, black 15%);
            -webkit-mask-image: linear-gradient(to right, transparent 0%, black 15%);
        }

        #content-sidebar {
            position: relative; width: 40%; height: 100vh; overflow-y: auto; z-index: 20;
            background: transparent; scrollbar-width: none; padding-left: 5%;
        }
        #content-sidebar::-webkit-scrollbar { display: none; }

        section {
            min-height: 100vh; display: flex; flex-direction: column; justify-content: center;
            padding-right: 50px; box-sizing: border-box;
        }

        .content-box {
            border-left: 4px solid var(--accent); padding-left: 30px;
            opacity: 0; transform: translateY(30px); transition: 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .content-box.visible { opacity: 1; transform: translateY(0); }

        h1 {
            font-family: 'Montserrat'; font-weight: 900; font-size: 80px; margin: 0;
            line-height: 0.85; letter-spacing: -3px; text-transform: uppercase;
            color: var(--text-main);
        }
        h2 {
            font-family: 'Rajdhani'; font-weight: 700; font-size: 14px; letter-spacing: 6px;
            margin: 0 0 20px 0; color: var(--accent); text-transform: uppercase;
        }
        h3 {
            font-family: 'Montserrat'; font-weight: 800; font-size: 32px; margin: 10px 0;
            color: var(--text-main);
        }
        p {
            font-family: 'Rajdhani'; font-weight: 600; font-size: 18px; line-height: 1.6;
            color: var(--text-sub); margin-bottom: 25px; max-width: 420px;
        }

        .interaction-hint {
            position: fixed; bottom: 30px; right: 30px; z-index: 30;
            text-align: right; font-family: 'Rajdhani'; font-weight: 700; font-size: 10px;
            color: var(--text-sub); letter-spacing: 1px; pointer-events: none;
            padding: 10px; border-right: 2px solid var(--accent);
        }

        .btn-cta {
            padding: 15px 35px; background: var(--text-main); color: var(--bg-color);
            border: 2px solid var(--text-main); font-family: 'Montserrat'; font-weight: 800;
            font-size: 12px; cursor: pointer; transition: 0.3s; text-decoration: none;
            display: inline-block; letter-spacing: 1px; margin-right: 10px; text-transform: uppercase;
        }
        .btn-cta:hover { background: var(--accent); border-color: var(--accent); color: #fff; }
        .btn-cta.secondary { background: transparent; color: var(--text-main); }
        .btn-cta.secondary:hover { background: var(--text-main); color: var(--bg-color); }

        @media (max-width: 768px) {
            #canvas-container { width: 100%; height: 50vh; top: 0; right: 0; mask-image: none; border-bottom: 1px solid var(--border-color);}
            #content-sidebar { width: 100%; height: 50vh; top: 50vh; background: var(--bg-color); padding-left: 0; }
            section { min-height: 50vh; padding: 40px 30px; justify-content: flex-start; }
            h1 { font-size: 50px; }
            #theme-toggle { top: 10px; left: 10px; padding: 5px 10px; font-size: 9px; }
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.skypack.dev/three@0.136.0",
                "three/addons/": "https://cdn.skypack.dev/three@0.136.0/examples/jsm/"
            }
        }
    </script>
</head>
<body data-theme="ludovico">

    <button id="theme-toggle">TEMA: KOROVA (LIGHT)</button>
    
    <div id="canvas-container"></div>

    <div class="interaction-hint">
        SCROLL : DESENSAMBLAR<br>
        CLICK IZQ : ROTAR | CLICK DER : MOVER
    </div>

    <div id="content-sidebar">
        <section id="sec-intro">
            <div class="content-box visible">
                <h2>AI ASSISTANT V.16.0</h2>
                <h1>ALEX</h1>
                <h1>VOICE</h1>
                <br>
                <p>Diseño inspirado en la estética 'Droog'. Ensamblaje monolítico sin tornillos y acústica de proyección superior.</p>
                <br>
                <a href="#" class="btn-cta">PRE-ORDENAR</a>
                <a href="#" class="btn-cta secondary">VER VIDEO</a>
            </div>
        </section>

        <section id="sec-design">
            <div class="content-box">
                <h2>ARQUITECTURA</h2>
                <h3>ARAÑA MONOLÍTICA</h3>
                <p>El sombrero y los cuatro tirantes estructurales son una sola pieza sólida. Se deslizan dentro del cuerpo cerámico blanco para un ajuste perfecto.</p>
            </div>
        </section>

        <section id="sec-tech">
            <div class="content-box">
                <h2>INTERFAZ</h2>
                <h3>SENSITIVE BRIM</h3>
                <p>El ala del bombín es táctil. Toca para silenciar, desliza para volumen. Tres LEDs frontales indican el estado de la IA.</p>
            </div>
        </section>

        <div style="height: 20vh;"></div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- GESTIÓN DE TEMAS (COLORES KOROVA) ---
        const themes = {
            ludovico: { 
                label: "KOROVA (LIGHT)",
                bg: 0xe6e6e6, 
                fogDensity: 0.015,
                rimIntensity: 1.0,
                // Colores Materiales
                c_body: 0xffffff, // Blanco
                c_base: 0xff6600, // Naranja
                c_hat: 0x111111,  // Negro
                c_boots: 0x111111 // Negro
            },
            ultra: { 
                label: "ULTRA (DARK)",
                bg: 0x111111, 
                fogDensity: 0.02,
                rimIntensity: 2.0,
                // Colores Invertidos
                c_body: 0x222222, 
                c_base: 0xcc0000, 
                c_hat: 0x000000,
                c_boots: 0x000000
            }
        };

        let currentThemeKey = 'ludovico';
        const toggleBtn = document.getElementById('theme-toggle');
        const bodyEl = document.body;

        // --- ESCENA 3D ---
        const container = document.getElementById('canvas-container');
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); // Alpha true para ver el fondo CSS
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 0.9;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        
        // --- CÁMARA ---
        const camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(-8, 4, 12); // Vista isométrica agradable

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enableZoom = true;
        controls.target.set(0, 2.5, 0);

        // --- MATERIALES (BASE) ---
        // Se actualizarán dinámicamente con la función de temas
        const matBody = new THREE.MeshStandardMaterial({ roughness: 0.4, metalness: 0.1 }); // Carcasa LIsa
        const matBase = new THREE.MeshStandardMaterial({ roughness: 0.6, metalness: 0.0 }); // Pantalón/Tirantes
        const matHat = new THREE.MeshStandardMaterial({ roughness: 0.7, metalness: 0.1 });  // Sombrero/Botas
        const matCore = new THREE.MeshBasicMaterial({ color: 0xff6600, wireframe: true });
        const matLed = new THREE.MeshBasicMaterial({ color: 0x00ffff }); // Cian LED

        // --- TEXTURA LOGO ---
        function createLogoTexture() {
            const canvas = document.createElement('canvas'); canvas.width = 512; canvas.height = 128;
            const ctx = canvas.getContext('2d'); 
            // Fondo transparente
            ctx.fillStyle = "rgba(0,0,0,0)"; ctx.fillRect(0,0,512,128);
            
            ctx.font = '900 80px "Montserrat", sans-serif'; 
            ctx.fillStyle = '#333333'; 
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; 
            ctx.fillText('A.L.E.X.', 256, 64);
            
            const texture = new THREE.CanvasTexture(canvas); 
            texture.needsUpdate = true;
            return texture;
        }
        const logoTexture = createLogoTexture();
        const matLogo = new THREE.MeshBasicMaterial({ map: logoTexture, transparent: true, opacity: 0.8 });


        // --- CONSTRUCCIÓN DEL ROBOT (V.16.0) ---
        const robotGroup = new THREE.Group();
        scene.add(robotGroup);
        const explodeParts = []; // Array para controlar animación

        function addToExplode(mesh, direction, speed = 1.0) {
            robotGroup.add(mesh);
            explodeParts.push({ mesh: mesh, originalY: mesh.position.y, direction: direction, speed: speed });
        }

        // 1. BOTAS (Negras)
        const bootsGroup = new THREE.Group();
        const bootGeo = new RoundedBoxGeometry(1.4, 1.0, 1.8, 4, 0.2);
        const bootL = new THREE.Mesh(bootGeo, matHat); bootL.position.set(-0.9, 0.5, 0); bootL.castShadow = true;
        const bootR = new THREE.Mesh(bootGeo, matHat); bootR.position.set(0.9, 0.5, 0); bootR.castShadow = true;
        bootsGroup.add(bootL, bootR);
        bootsGroup.position.y = 0;
        addToExplode(bootsGroup, -1, 0.5); // Bajan al explotar

        // 2. BASE PANTALÓN (Naranja)
        const baseGeo = new THREE.CylinderGeometry(1.7, 1.9, 1.5, 64);
        const baseMesh = new THREE.Mesh(baseGeo, matBase);
        baseMesh.position.y = 1.75; baseMesh.castShadow = true;
        addToExplode(baseMesh, 0, 0); // Se queda quieta

        // 3. COLUMNA INTERNA (Gris)
        const spineMesh = new THREE.Mesh(new THREE.CylinderGeometry(0.4, 0.4, 4.0, 16), new THREE.MeshStandardMaterial({color: 0x333333}));
        spineMesh.position.y = 3.0;
        addToExplode(spineMesh, 0, 0);

        // 4. CARCASA CUERPO (Blanca, Cilíndrica, Lisa)
        const bodyGeo = new THREE.CylinderGeometry(1.7, 1.7, 3.5, 64);
        const bodyMesh = new THREE.Mesh(bodyGeo, matBody);
        bodyMesh.position.y = 4.25; bodyMesh.castShadow = true; bodyMesh.receiveShadow = true;
        
        // Logo Overlay
        const logoPlane = new THREE.Mesh(new THREE.PlaneGeometry(2.0, 0.5), matLogo);
        logoPlane.position.set(0, -1.0, 1.71); // Pegado al frente
        bodyMesh.add(logoPlane);
        
        addToExplode(bodyMesh, 1, 1.0); // Sube

        // 5. NÚCLEO IA
        const coreMesh = new THREE.Mesh(new THREE.IcosahedronGeometry(0.6, 0), matCore);
        coreMesh.position.y = 4.5;
        addToExplode(coreMesh, 1, 1.2); // Sube un poco más rápido

        // 6. ARAÑA SUPERIOR (SOMBRERO + TIRANTES) - MONOLÍTICA
        const spiderGroup = new THREE.Group();
        spiderGroup.position.y = 6.0; // Posición cerrada (encima del cuerpo)

        // A. Sombrero (Negro)
        const hatGroup = new THREE.Group();
        // Domo
        const domeMesh = new THREE.Mesh(new THREE.SphereGeometry(1.8, 64, 32, 0, Math.PI*2, 0, Math.PI/2), matHat);
        hatGroup.add(domeMesh);
        // Ala (Torus)
        const brimMesh = new THREE.Mesh(new THREE.TorusGeometry(1.8, 0.4, 16, 64), matHat);
        brimMesh.rotation.x = Math.PI / 2;
        hatGroup.add(brimMesh);
        
        // LEDs Frontales (3 puntos)
        [-0.3, 0, 0.3].forEach(x => {
            const led = new THREE.Mesh(new THREE.SphereGeometry(0.08, 16, 16), matLed);
            led.position.set(x, 0.5, 1.7);
            hatGroup.add(led);
        });

        spiderGroup.add(hatGroup);

        // B. Tirantes (Naranjas) - Bajando desde el sombrero
        // 4 Tirantes a 25 grados del eje frontal/trasero
        const angles = [25, 155, 205, 335].map(deg => deg * (Math.PI/180)); // Ángulos en radianes
        const suspenderGeo = new RoundedBoxGeometry(0.2, 3.8, 0.5, 4, 0.05); // Largos y planos

        angles.forEach(ang => {
            const suspender = new THREE.Mesh(suspenderGeo, matBase); // Material Naranja
            // Posicionar en el borde del radio del cuerpo
            const r = 1.75; 
            suspender.position.set(Math.sin(ang) * r, -1.9, Math.cos(ang) * r); // -1.9 para que cuelguen hacia abajo
            suspender.rotation.y = ang; // Rotar para mirar al centro
            spiderGroup.add(suspender);
        });

        // La araña sube MUCHO para mostrar cómo salen los tirantes
        addToExplode(spiderGroup, 1, 3.5); 


        // --- ILUMINACIÓN ---
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.6);
        scene.add(hemiLight);
        
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // --- LÓGICA DE TEMAS ---
        function applyTheme(key) {
            const t = themes[key];
            
            // CSS
            bodyEl.setAttribute('data-theme', key);
            toggleBtn.innerText = "TEMA: " + t.label;
            
            // Three.js Scene
            scene.background = null; // Usar CSS
            scene.fog = new THREE.FogExp2(t.bg, t.fogDensity);
            
            // Materiales
            matBody.color.setHex(t.c_body);
            matBase.color.setHex(t.c_base);
            matHat.color.setHex(t.c_hat);
            
            // El logo necesita invertirse según el fondo
            const ctx = logoTexture.image.getContext('2d');
            ctx.clearRect(0,0,512,128);
            ctx.fillStyle = (key === 'ludovico') ? '#333333' : '#EEEEEE';
            ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.font = '900 80px "Montserrat"';
            ctx.fillText('A.L.E.X.', 256, 64);
            logoTexture.needsUpdate = true;
        }
        applyTheme('ludovico');

        toggleBtn.addEventListener('click', () => {
            currentThemeKey = (currentThemeKey === 'ludovico') ? 'ultra' : 'ludovico';
            applyTheme(currentThemeKey);
        });

        // --- POST PROCESADO (BLOOM) ---
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.2; bloomPass.strength = 0.4; bloomPass.radius = 0.5;
        composer.addPass(bloomPass);

        // --- SCROLL ANIMATION ---
        let explodeTarget = 0;
        let explodeCurrent = 0;

        window.addEventListener('wheel', (e) => {
            // Normalizamos un poco el scroll
            explodeTarget += e.deltaY * 0.005;
            explodeTarget = Math.max(0, Math.min(2.0, explodeTarget)); // Límite de explosión
        });

        // Animación Loop
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            const time = clock.getElapsedTime();

            // Suavizado del scroll
            explodeCurrent += (explodeTarget - explodeCurrent) * 0.1;

            // Mover piezas
            explodeParts.forEach(part => {
                // Posición original + (Dirección * Factor * VelocidadEspecífica)
                part.mesh.position.y = part.originalY + (part.direction * explodeCurrent * part.speed);
            });

            // Rotación suave del modelo entero (flotación)
            robotGroup.rotation.y = Math.sin(time * 0.2) * 0.1;
            robotGroup.position.y = Math.sin(time * 0.5) * 0.1 - 2.0; // Centrar en pantalla

            // Rotación del núcleo
            coreMesh.rotation.x += delta;
            coreMesh.rotation.y += delta * 0.5;

            controls.update();
            composer.render();
        }

        animate();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
            composer.setSize(container.clientWidth, container.clientHeight);
        });

        // Scroll Sidebar Fade
        const sidebar = document.getElementById('content-sidebar');
        const boxes = document.querySelectorAll('.content-box');
        sidebar.addEventListener('scroll', () => {
            boxes.forEach(box => {
                const rect = box.getBoundingClientRect();
                if(rect.top < window.innerHeight * 0.8) box.classList.add('visible');
            });
        });

    </script>
</body>
</html>
