<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALEX ASSISTANT | CINEMATIC RENDER</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #050505;
            --text-main: #ffffff;
            --accent: #FF4500;
        }

        [data-theme="ultra"] {
            --bg-color: #4b0000; /* Rojo profundo tipo Kubrick */
            --text-main: #ffffff;
            --accent: #ffffff;
        }

        body {
            margin: 0; background: var(--bg-color); color: var(--text-main);
            font-family: 'Rajdhani', sans-serif; overflow: hidden;
            transition: background 1.2s ease-in-out;
        }

        /* UI Overlays */
        #theme-toggle {
            position: fixed; top: 40px; left: 40px; z-index: 100;
            background: transparent; border: 1px solid var(--text-main);
            color: var(--text-main); padding: 12px 24px; cursor: pointer;
            font-weight: 700; letter-spacing: 2px; transition: 0.3s;
        }
        #theme-toggle:hover { background: var(--text-main); color: #000; }

        #canvas-container {
            position: fixed; top: 0; right: 0; width: 100%; height: 100vh;
        }

        .content {
            position: relative; z-index: 10; padding: 10vh 5%;
            width: 35%; pointer-events: none;
        }

        h1 { font-family: 'Montserrat'; font-size: 8rem; line-height: 0.8; margin: 0; }
        .tag { color: var(--accent); font-weight: 700; letter-spacing: 5px; }

        .controls-hint {
            position: fixed; bottom: 40px; left: 40px; font-size: 11px;
            opacity: 0.5; line-height: 1.8;
        }
    </style>
</head>
<body data-theme="ludovico">

    <button id="theme-toggle">MODE: LUDOVICO</button>

    <div class="content">
        <span class="tag">SYSTEM ACTIVE</span>
        <h1>ALEX</h1>
        <p>Advanced Logic Electronic eXperience. <br>Diseñado para la eficiencia. Construido para el control.</p>
    </div>

    <div class="controls-hint">
        MOUSE: ROTAR MODELO<br>
        SCROLL: DISTANCIA<br>
        CTRL + SCROLL: MODO EXPLOSIÓN
    </div>

    <div id="canvas-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.skypack.dev/three@0.136.0",
                "three/addons/": "https://cdn.skypack.dev/three@0.136.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'three/addons/geometries/RoundedBoxGeometry.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- CONFIGURACIÓN ---
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 2, 12);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        renderer.shadowMap.enabled = true;
        container.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // --- TEXTURA DEL LOGO ALEX (Dinámica) ---
        function createLogoTexture() {
            const canvas = document.createElement('canvas');
            canvas.width = 512; canvas.height = 128;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = "white"; // Dibujamos en blanco para poder teñirlo
            ctx.font = "bold 80px Montserrat";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText("ALEX", 256, 64);
            const tex = new THREE.CanvasTexture(canvas);
            return tex;
        }

        // --- MATERIALES MEJORADOS ---
        const matWhite = new THREE.MeshPhysicalMaterial({
            color: 0xffffff, roughness: 0.15, metalness: 0.05,
            clearcoat: 1.0, clearcoatRoughness: 0.1
        });

        const matBlack = new THREE.MeshPhysicalMaterial({
            color: 0x111111, roughness: 0.8, metalness: 0.1
        });

        const matOrange = new THREE.MeshStandardMaterial({
            color: 0x000000, emissive: 0xff4400, emissiveIntensity: 5
        });

        const matLogo = new THREE.MeshBasicMaterial({ 
            map: createLogoTexture(), 
            transparent: true, 
            color: 0x000000 // Color del texto "ALEX"
        });

        // --- CONSTRUCCIÓN DEL MODELO ---
        const alexGroup = new THREE.Group();
        const parts = [];

        // Cuerpo (Cilindro con Logo)
        const bodyGeo = new THREE.CylinderGeometry(1.6, 1.6, 3.2, 64);
        const body = new THREE.Mesh(bodyGeo, matWhite);
        body.position.y = 2.8;
        body.castShadow = true;
        
        // El Logo ALEX envuelto
        const logoGeo = new THREE.CylinderGeometry(1.61, 1.61, 0.8, 64, 1, true);
        const logo = new THREE.Mesh(logoGeo, matLogo);
        logo.position.y = -0.8; // Posición baja como en el video
        body.add(logo);
        
        alexGroup.add(body);
        parts.push({ mesh: body, factor: 0 });

        // Anillo de luz
        const ringGeo = new THREE.TorusGeometry(1.62, 0.06, 16, 100);
        const ring = new THREE.Mesh(ringGeo, matOrange);
        ring.rotation.x = Math.PI/2;
        ring.position.y = 2.8;
        alexGroup.add(ring);
        parts.push({ mesh: ring, factor: 0.5 });

        // Sombrero (Cabeza)
        const headGroup = new THREE.Group();
        const dome = new THREE.Mesh(new THREE.SphereGeometry(1.6, 64, 32, 0, Math.PI*2, 0, Math.PI/2), matBlack);
        const brim = new THREE.Mesh(new THREE.CylinderGeometry(1.9, 1.6, 0.1, 64), matBlack);
        headGroup.add(dome, brim);
        headGroup.position.y = 4.4;
        
        // Ojos (3 puntos)
        [ -0.4, 0, 0.4 ].forEach(x => {
            const eye = new THREE.Mesh(new THREE.SphereGeometry(0.12, 16, 16), matOrange);
            eye.position.set(x, 0.6, 1.4);
            headGroup.add(eye);
        });
        
        alexGroup.add(headGroup);
        parts.push({ mesh: headGroup, factor: 1.5 });

        // Pies (Botas)
        const footGeo = new RoundedBoxGeometry(1.3, 1, 1.8, 6, 0.3);
        const footL = new THREE.Mesh(footGeo, matBlack);
        footL.position.set(-0.8, 0.5, 0.2);
        const footR = footL.clone();
        footR.position.x = 0.8;
        alexGroup.add(footL, footR);
        parts.push({ mesh: footL, factor: -1 }, { mesh: footR, factor: -1 });

        scene.add(alexGroup);

        // --- ILUMINACIÓN CINEMATOGRÁFICA ---
        const mainLight = new THREE.SpotLight(0xffffff, 2);
        mainLight.position.set(5, 10, 5);
        mainLight.castShadow = true;
        scene.add(mainLight);

        const rimLight = new THREE.PointLight(0xffffff, 1.5);
        rimLight.position.set(-5, 5, -5);
        scene.add(rimLight);

        const ambient = new THREE.AmbientLight(0xffffff, 0.2);
        scene.add(ambient);

        // --- POST-PROCESAMIENTO ---
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        const bloom = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.2, 0.4, 0.8);
        composer.addPass(bloom);

        // --- LÓGICA DE INTERACCIÓN ---
        let explodeVal = 0;
        let targetExplode = 0;

        window.addEventListener('wheel', (e) => {
            if (e.ctrlKey) {
                e.preventDefault();
                targetExplode = Math.max(0, Math.min(2, targetExplode + e.deltaY * 0.001));
            }
        }, { passive: false });

        // Cambiar Temas
        const btn = document.getElementById('theme-toggle');
        btn.addEventListener('click', () => {
            const isDark = document.body.getAttribute('data-theme') === 'ludovico';
            const nextTheme = isDark ? 'ultra' : 'ludovico';
            document.body.setAttribute('data-theme', nextTheme);
            btn.innerText = `MODE: ${nextTheme.toUpperCase()}`;
            
            // Ajuste de luces por tema
            if (nextTheme === 'ultra') {
                matOrange.emissive.setHex(0xffffff);
                bloom.strength = 0.8;
            } else {
                matOrange.emissive.setHex(0xff4400);
                bloom.strength = 1.2;
            }
        });

        // --- ANIMACIÓN ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            // Suavizado de explosión
            explodeVal += (targetExplode - explodeVal) * 0.1;
            parts.forEach(p => {
                p.mesh.position.y += (explodeVal * p.factor * 0.1);
            });

            // Flotación suave
            alexGroup.position.y = Math.sin(Date.now() * 0.002) * 0.15;
            
            composer.render();
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
