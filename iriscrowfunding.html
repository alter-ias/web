<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IRIS | Hardware Open Source</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Montserrat:wght@300;400;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            margin: 0;
            background: #050505;
            color: #fff;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            /* Prevent body scroll on mobile to prioritize split view */
        }

        /* SPLIT LAYOUT DESKTOP */
        #canvas-container {
            position: fixed;
            top: 0;
            right: 0;
            width: 60%;
            height: 100vh;
            z-index: 10;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
        }

        #content-sidebar {
            position: relative;
            width: 40%;
            height: 100vh;
            overflow-y: auto;
            /* Scrollable sidebar for desktop too, cleaner */
            z-index: 20;
            background: linear-gradient(90deg, #050505 0%, #050505 80%, transparent 100%);
            scrollbar-width: none;
            /* Hide scrollbar for aesthetics */
        }

        #content-sidebar::-webkit-scrollbar {
            display: none;
        }

        section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 10%;
            box-sizing: border-box;
        }

        .content-box {
            padding: 40px 0;
            border-left: 2px solid #00E5FF;
            padding-left: 30px;
            opacity: 0;
            transform: translateY(30px);
            transition: 0.8s ease-out;
        }

        .content-box.visible {
            opacity: 1;
            transform: translateY(0);
        }

        h1 {
            font-family: 'Rajdhani';
            font-size: 80px;
            margin: 0;
            line-height: 0.9;
            text-transform: uppercase;
            color: #fff;
            text-shadow: 0 0 20px rgba(0, 229, 255, 0.3);
        }

        h2 {
            font-family: 'Rajdhani';
            font-size: 40px;
            margin: 0 0 20px 0;
            color: #00E5FF;
            text-transform: uppercase;
        }

        p {
            font-size: 16px;
            line-height: 1.6;
            color: #ccc;
            margin-bottom: 20px;
            max-width: 400px;
        }

        .accent {
            color: #00E5FF;
            font-weight: 700;
        }

        .scroll-indicator {
            margin-top: 40px;
            color: #444;
            font-size: 12px;
            letter-spacing: 2px;
        }

        .interaction-hint {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 30;
            text-align: right;
            font-size: 10px;
            color: #666;
            letter-spacing: 1px;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 4px;
        }

        .key {
            border: 1px solid #444;
            padding: 2px 4px;
            border-radius: 3px;
            color: #888;
        }

        .footer {
            height: 50vh;
        }

        .btn-cta {
            padding: 15px 40px;
            border: 1px solid #00E5FF;
            color: #00E5FF;
            background: transparent;
            font-family: 'Rajdhani';
            font-size: 18px;
            cursor: pointer;
            transition: 0.3s;
            text-decoration: none;
            display: inline-block;
            letter-spacing: 2px;
            margin-right: 10px;
            margin-bottom: 10px;
            text-align: center;
        }

        .btn-cta:hover {
            background: #00E5FF;
            color: #000;
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.4);
        }

        .btn-cta.secondary {
            border-color: #fff;
            color: #fff;
        }

        .btn-cta.secondary:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
        }

        /* MOBILE RESPONSIVE BLOCK - VERTICAL SPLIT */
        @media (max-width: 768px) {
            body {
                overflow: hidden;
                height: 100vh;
            }

            #canvas-container {
                width: 100%;
                height: 50%;
                top: 0;
                left: 0;
                right: auto;
                bottom: auto;
                background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
            }

            #content-sidebar {
                width: 100%;
                height: 50%;
                position: absolute;
                bottom: 0;
                left: 0;
                background: #050505;
                padding-bottom: 0;
                margin-top: 0;
                border-top: 1px solid #222;
                box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
            }

            section {
                min-height: 50vh;
                /* Make each section fit the half screen exactly */
                padding: 40px 30px;
                justify-content: center;
                border-bottom: 1px solid #111;
            }

            h1 {
                font-size: 50px;
            }

            h2 {
                font-size: 28px;
            }

            .interaction-hint {
                top: 10px;
                right: 10px;
                bottom: auto;
                font-size: 9px;
            }
        }
    </style>
</head>

<body>

    <div id="canvas-container"></div>

    <div class="interaction-hint">
        SCROLL : DETALLES<br>
        <span class="key">CTRL</span> + SCROLL : EXPLOSIÓN<br>
        (SAFARI: PINCH ZOOM)<br>
        DRAG : ROTAR 3D
    </div>

    <div id="content-sidebar">
        <section id="sec-intro">
            <div class="content-box visible" style="border:none; padding-left:0;">
                <h1 style="color:#00E5FF">IRIS</h1>
                <h1 style="font-size: 30px; letter-spacing: 10px; color: #888;">VISUAL SYNTH</h1>
                <br>
                <p>La herramienta definitiva para la <span class="accent">performance visual</span>.</p>
                <div class="scroll-indicator">▼ DESLIZA PARA VERIFICAR</div>
            </div>
        </section>

        <section id="sec-design">
            <div class="content-box">
                <h2>Ingeniería CNC</h2>
                <p>Chasis fresado en <span class="accent">Aluminio 6061-T6</span>. Estructura Unibody robusta para el
                    tour.</p>
                <p>Acabado anodizado negro mate industrial. Componentes de grado militar probados para resistir.</p>
            </div>
        </section>

        <section id="sec-features">
            <div class="content-box">
                <h2>Interface Táctil</h2>
                <p>Faders lineales de 60mm con respuesta suave. Encoders infinitos de alta resolución.</p>
                <p>Botones con estabilización mecánica y retroiluminación RGB individual para feedback inmediato en la
                    oscuridad.</p>
            </div>
        </section>

        <section id="sec-opensource">
            <div class="content-box">
                <h2>Open Hardware</h2>
                <p>IRIS es completamente transparente. Schematics, PCB, y Código Firmware disponibles.</p>
                <p>Diseñado para ser reparable y modificable por el usuario. Sin obsolescencia programada.</p>
            </div>
        </section>

        <section id="sec-explode">
            <div class="content-box" style="border:none;">
                <h2>ÚNETE AL CO-LAB</h2>
                <p>Sé parte de la primera generación de IRIS.</p>
                <br>
                <a href="https://www.alterlabgen.lat/iris.html" class="btn-cta">IR A LA APP WEB</a>
                <a href="https://www.alterlabgen.lat/co-laboratorio.html" class="btn-cta secondary">CROWDFUNDING</a>
            </div>
        </section>

        <div style="height: 10vh;"></div>
    </div>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.136.0';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/controls/OrbitControls.js';
        import { RoundedBoxGeometry } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/geometries/RoundedBoxGeometry.js';
        import { RectAreaLightUniformsLib } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/lights/RectAreaLightUniformsLib.js';
        import { FontLoader } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/loaders/FontLoader.js';
        import { TextGeometry } from 'https://cdn.skypack.dev/three@0.136.0/examples/jsm/geometries/TextGeometry.js';

        // --- SCROLL LISENER FIXED FOR SPLIT LAYOUT ---
        const sidebar = document.getElementById('content-sidebar');
        const sections = document.querySelectorAll('section');
        let scrollY = 0;
        let pScroll = 0;

        function updateScroll() {
            // Use sidebar scroll position instead of window for consistent split view logic
            scrollY = sidebar.scrollTop;
            const max = sidebar.scrollHeight - sidebar.clientHeight;
            pScroll = Math.max(0, Math.min(1, scrollY / max));

            sections.forEach(sec => {
                // Check position relative to the sidebar viewport
                const rect = sec.getBoundingClientRect();
                // We need to check intersection with the sidebar rect basically
                // Since sidebar is 100vh or 50vh, windo.innerHeight matches roughly
                // Simple logic: if within view
                if (rect.top < window.innerHeight * 0.8) {
                    const box = sec.querySelector('.content-box');
                    if (box) box.classList.add('visible');
                }
            });
        }
        // Listen to sidebar scroll, not window scroll
        sidebar.addEventListener('scroll', updateScroll);
        updateScroll();


        // --- 3D SETUP ---
        const container = document.getElementById('canvas-container');
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });

        // Dynamic Size Init
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        container.appendChild(renderer.domElement);

        const scene = new THREE.Scene();

        const camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.set(0, 8, 8); // Start position

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enableZoom = true;
        controls.minDistance = 4;
        controls.maxDistance = 20;

        // Lights
        RectAreaLightUniformsLib.init();
        const ambient = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambient);
        const spot1 = new THREE.SpotLight(0xffffff, 5);
        spot1.position.set(5, 10, 5); spot1.angle = Math.PI / 6; spot1.castShadow = true; scene.add(spot1);
        const rectLight = new THREE.RectAreaLight(0xffffff, 2, 10, 10);
        rectLight.position.set(-5, 5, 5); rectLight.lookAt(0, 0, 0); scene.add(rectLight);
        const spot2 = new THREE.SpotLight(0xddeeff, 3);
        spot2.position.set(0, 5, -8); spot2.lookAt(0, 0, 0); scene.add(spot2);

        // Materials - UPDATED FOR REALISM
        const mats = {
            aluminum: new THREE.MeshStandardMaterial({
                color: 0x222222, // Darker Anodized 
                roughness: 0.6,
                metalness: 0.8
            }),
            ceramic: new THREE.MeshPhysicalMaterial({ color: 0x111111, roughness: 0.8, clearcoat: 0.5 }), // Polymer
            glass: new THREE.MeshPhysicalMaterial({ color: 0xffffff, roughness: 0.0, transmission: 0.95, thickness: 1.0 }),
            plasticBlack: new THREE.MeshStandardMaterial({ color: 0x050505, roughness: 0.9 }),
            glowCyan: new THREE.MeshStandardMaterial({ color: 0x00ffff, emissive: 0x00E5FF, emissiveIntensity: 2.0, toneMapped: false }),
            glowWhite: new THREE.MeshStandardMaterial({ color: 0xaaccff, emissive: 0xaaccff, emissiveIntensity: 1.5, toneMapped: false }),
            glowRose: new THREE.MeshStandardMaterial({ color: 0xffaacc, emissive: 0xff88aa, emissiveIntensity: 1.5, toneMapped: false }),
            glowInd: new THREE.MeshStandardMaterial({ color: 0xffffff, emissive: 0xffffff, emissiveIntensity: 3.0, toneMapped: false }),
            text: new THREE.MeshStandardMaterial({ color: 0x888888, roughness: 0.8, metalness: 0.5 }) // Laser etched look
        };

        // --- MODEL CONSTRUCTION ---
        const group = new THREE.Group();
        scene.add(group);
        const parts = { chassis: [], fader: [], knobs: [], keysLeft: [], keysRight: [], center: [], corners: [] };
        function addPart(arr, mesh) { arr.push({ mesh: mesh, home: mesh.position.clone() }); }

        // Chassis
        const chassis = new THREE.Mesh(new RoundedBoxGeometry(6, 0.6, 4, 10, 0.05), mats.aluminum); // Sharper edges for CNC look
        chassis.castShadow = true; chassis.receiveShadow = true; group.add(chassis);
        addPart(parts.chassis, chassis);

        // Fader
        const fGrp = new THREE.Group();
        const slot = new THREE.Mesh(new RoundedBoxGeometry(2.5, 0.05, 0.15, 2, 0.02), mats.plasticBlack);
        slot.position.set(0, 0.301, 1.2); fGrp.add(slot);
        const hand = new THREE.Mesh(new RoundedBoxGeometry(0.3, 0.4, 0.12, 4, 0.02), mats.aluminum); // Metal cap
        hand.position.set(0, 0.45, 1.2); hand.castShadow = true; fGrp.add(hand);
        const halo = new THREE.Mesh(new THREE.PlaneGeometry(0.5, 0.3), mats.glowCyan);
        halo.rotation.x = -Math.PI / 2; halo.position.set(0, 0.302, 1.2); fGrp.add(halo);
        group.add(fGrp); addPart(parts.fader, fGrp);

        // Knobs
        const kGeo = new THREE.CylinderGeometry(0.25, 0.25, 0.2, 32);
        for (let i = 0; i < 6; i++) {
            const kGrp = new THREE.Group(); kGrp.position.set(-2.0 + (i * 0.8), 0.3, 0.6);
            const b = new THREE.Mesh(kGeo, mats.aluminum); b.position.y = 0.1; b.castShadow = true; kGrp.add(b);
            const ind = new THREE.Mesh(new THREE.CircleGeometry(0.02, 16), mats.glowInd);
            ind.rotation.x = -Math.PI / 2; ind.position.set(0, 0.201, -0.18); kGrp.add(ind);
            group.add(kGrp); addPart(parts.knobs, kGrp);
        }

        // Keys
        const keyGeo = new RoundedBoxGeometry(0.35, 0.1, 0.35, 4, 0.02);
        const lg = new THREE.Group(); const rg = new THREE.Group();
        group.add(lg); group.add(rg);
        addPart(parts.keysLeft, lg); addPart(parts.keysRight, rg);
        for (let r = 0; r < 4; r++) {
            for (let c = 0; c < 4; c++) {
                const k1 = new THREE.Mesh(keyGeo, mats.ceramic); k1.position.set(-2.2 + c * 0.4, 0.32, -1.2 + r * 0.4); k1.castShadow = true; lg.add(k1);
                const p1 = new THREE.Mesh(new THREE.PlaneGeometry(0.36, 0.36), mats.glowWhite); p1.rotation.x = -Math.PI / 2; p1.position.set(k1.position.x, 0.301, k1.position.z); lg.add(p1);
                const k2 = new THREE.Mesh(keyGeo, mats.ceramic); k2.position.set(1.0 + c * 0.4, 0.32, -1.2 + r * 0.4); k2.castShadow = true; rg.add(k2);
                const p2 = new THREE.Mesh(new THREE.PlaneGeometry(0.36, 0.36), mats.glowRose); p2.rotation.x = -Math.PI / 2; p2.position.set(k2.position.x, 0.301, k2.position.z); rg.add(p2);
            }
        }

        // Center & Corners
        const cGrp = new THREE.Group();
        const gBtn = new THREE.Mesh(new THREE.CylinderGeometry(0.6, 0.6, 0.05, 64), mats.glass);
        gBtn.position.set(0, 0.32, -0.6); cGrp.add(gBtn);
        group.add(cGrp); addPart(parts.center, cGrp);
        const cnGeo = new THREE.CylinderGeometry(0.18, 0.18, 0.1, 32);
        const cbL = new THREE.Mesh(cnGeo, mats.aluminum); cbL.position.set(-2.5, 0.32, 1.5); cbL.castShadow = true; group.add(cbL);
        addPart(parts.corners, cbL);
        const cbR = new THREE.Mesh(cnGeo, mats.aluminum); cbR.position.set(2.5, 0.32, 1.5); cbR.castShadow = true; group.add(cbR);
        addPart(parts.corners, cbR);

        // Text
        const loader = new FontLoader();
        loader.load('https://cdn.skypack.dev/three@0.136.0/examples/fonts/helvetiker_regular.typeface.json', function (font) {
            const t1 = new THREE.Mesh(new TextGeometry('IRIS', { font: font, size: 0.15, height: 0.01 }), mats.text);
            t1.rotation.x = -Math.PI / 2; t1.position.set(-2.8, 0.301, -1.6); group.add(t1);
            addPart(parts.chassis, t1);
            const t2 = new THREE.Mesh(new TextGeometry('ALTERLAB', { font: font, size: 0.06, height: 0.005 }), mats.text);
            t2.position.set(-1.5, 0.0, -2.01); t2.rotation.y = Math.PI; group.add(t2);
            addPart(parts.chassis, t2);
        });

        const floor = new THREE.Mesh(new THREE.PlaneGeometry(50, 50), new THREE.ShadowMaterial({ opacity: 0.1 }));
        floor.rotation.x = -Math.PI / 2; floor.position.y = -0.3; scene.add(floor);


        // --- INTERACTION & ANIMATION LOGIC ---
        let explodeTarget = 0.0;
        let explodeCurrent = 0.0;

        // PC MOUSE INTERACTION
        window.addEventListener('wheel', (e) => {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                controls.enableZoom = false;
                explodeTarget += e.deltaY * 0.001;
                explodeTarget = Math.max(0, Math.min(1, explodeTarget));
            } else {
                controls.enableZoom = true;
            }
        }, { passive: false });

        window.addEventListener('keyup', (e) => {
            if (e.key === 'Control' || e.key === 'Meta') controls.enableZoom = true;
        });

        // SAFARI / MOBILE TOUCH INTERACTION
        let lastScale = 1;
        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
            lastScale = 1;
            controls.enabled = false;
        });
        document.addEventListener('gesturechange', (e) => {
            e.preventDefault();
            const delta = e.scale - lastScale;
            lastScale = e.scale;
            explodeTarget += delta * 2.0;
            explodeTarget = Math.max(0, Math.min(1, explodeTarget));
        });
        document.addEventListener('gestureend', (e) => {
            e.preventDefault();
            controls.enabled = true;
        });


        function animate() {
            requestAnimationFrame(animate);
            controls.update();

            const targetRotY = pScroll * 0.5;
            const targetRotX = pScroll * 0.2;
            group.rotation.y += (targetRotY - group.rotation.y) * 0.05;
            group.rotation.x += (targetRotX - group.rotation.x) * 0.05;

            explodeCurrent += (explodeTarget - explodeCurrent) * 0.1;

            if (Math.abs(explodeTarget - explodeCurrent) > 0.0001 || explodeCurrent > 0.001) {
                const ex = explodeCurrent;
                parts.fader.forEach(p => { p.mesh.position.y = p.home.y + ex * 1.5; p.mesh.position.z = p.home.z + ex * 0.5; });
                parts.knobs.forEach((p, i) => { p.mesh.position.y = p.home.y + ex * 2.0 + (i * 0.05 * ex); });
                parts.keysLeft.forEach(p => {
                    p.mesh.position.y = p.home.y + ex * 2.5; p.mesh.position.x = p.home.x - ex; p.mesh.position.z = p.home.z - ex * 0.5;
                    p.mesh.rotation.z = ex * 0.1;
                });
                parts.keysRight.forEach(p => {
                    p.mesh.position.y = p.home.y + ex * 2.5; p.mesh.position.x = p.home.x + ex; p.mesh.position.z = p.home.z - ex * 0.5;
                    p.mesh.rotation.z = -ex * 0.1;
                });
                parts.center.forEach(p => { p.mesh.position.y = p.home.y + ex * 3.0; });
                parts.corners.forEach(p => {
                    const dirX = Math.sign(p.home.x);
                    p.mesh.position.y = p.home.y + ex * 1.0; p.mesh.position.x = p.home.x + dirX * ex * 1.5; p.mesh.position.z = p.home.z + ex * 1.5;
                });
                parts.chassis.forEach(p => {
                    if (p.mesh !== chassis) p.mesh.position.y = p.home.y + ex * 0.05;
                });
            } else {
                [...parts.fader, ...parts.knobs, ...parts.keysLeft, ...parts.keysRight, ...parts.center, ...parts.corners].forEach(p => {
                    p.mesh.position.lerp(p.home, 0.1);
                    p.mesh.rotation.set(0, 0, 0);
                });
            }

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            const w = container.clientWidth;
            const h = container.clientHeight;
            camera.aspect = w / h;
            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
        });

        window.dispatchEvent(new Event('resize'));
        animate();
    </script>
</body>

</html>
