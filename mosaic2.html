<!DOCTYPE html>
<html lang="en">
<head>
    <title>Three.js - Fix Import Map</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; }
    </style>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <div id="container"></div>

    <script type="module">
        // --------------------------------------------------------
        // IMPORTACIONES CORREGIDAS (Ya no usan rutas locales ./)
        // --------------------------------------------------------
        import * as THREE from 'three';
        
        // Loaders y Animación (Vistos en tu error log)
        import { MMDLoader } from 'three/addons/loaders/MMDLoader.js';
        import { CCDIKSolver } from 'three/addons/animation/CCDIKSolver.js';
        
        // Post-procesado (Vistos en tu error log)
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { ShaderPass } from 'three/addons/postprocessing/ShaderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --------------------------------------------------------
        // AQUÍ EMPIEZA TU LÓGICA
        // Pega aquí abajo el resto de tu código (init, animate, etc.)
        // --------------------------------------------------------

        let scene, camera, renderer, composer;

        init();
        animate();

        function init() {
            // Configuración básica para probar que funciona
            const container = document.getElementById( 'container' );
            
            camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
            camera.position.z = 30;

            scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x000000 );

            // Ejemplo: Una luz
            const ambient = new THREE.AmbientLight( 0x666666 );
            scene.add( ambient );

            // Renderizador
            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( window.innerWidth, window.innerHeight );
            container.appendChild( renderer.domElement );

            // Post-procesado básico (para probar las importaciones)
            composer = new EffectComposer( renderer );
            const renderPass = new RenderPass( scene, camera );
            composer.addPass( renderPass );

            // Aquí iría tu carga de MMD...
            // const loader = new MMDLoader();
            // ...
            
            window.addEventListener( 'resize', onWindowResize );
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize( window.innerWidth, window.innerHeight );
            composer.setSize( window.innerWidth, window.innerHeight );
        }

        function animate() {
            requestAnimationFrame( animate );
            // renderer.render( scene, camera ); // Usar composer si hay efectos
            composer.render();
        }
    </script>
</body>
</html>
