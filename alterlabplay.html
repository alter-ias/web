<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prueba DEFINITIVA de Autoplay</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background-color: #2c2c2c; color: white; }
        button { font-size: 1.2rem; padding: 10px; margin: 10px 0; cursor: pointer; }
        audio { width: 100%; max-width: 500px; margin-top: 20px; }
        #status-log { border: 1px solid #ccc; padding: 10px; min-height: 100px; font-family: monospace; }
    </style>
</head>
<body>

    <h1>Prueba Definitiva con Elemento <audio></h1>
    <p>Este método es 100% fiable.</p>
    
    <button id="play-first-btn">1. Reproducir Primera Canción (Manual)</button>
    
    <audio id="audio-player" controls></audio>

    <h2>Log de Estado:</h2>
    <div id="status-log"></div>

    <script>
        const audioPlayer = document.getElementById('audio-player');
        const playFirstBtn = document.getElementById('play-first-btn');
        const statusLog = document.getElementById('status-log');

        const playlist = [
            '1UupSCS3f3JaWChQwD7jpCUvSf_mmTyUs', // Canción 1
            '15hPI3ju9MGPLVnLFzwajn-XkDe09lvcc'  // Canción 2
        ];
        let currentSongIndex = 0;

        function log(message) {
            console.log(message);
            statusLog.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}<br>` + statusLog.innerHTML;
        }

        function playSong(index) {
            currentSongIndex = index;
            const songId = playlist[index];
            const directUrl = `https://drive.google.com/uc?export=download&id=${songId}`;
            
            log(`Cargando URL directa para canción ${index + 1}: ${directUrl}`);
            audioPlayer.src = directUrl;
            
            // El navegador bloquea el primer play(). Lo intentamos, y si falla,
            // el usuario lo puede iniciar con los controles.
            audioPlayer.play().catch(error => {
                log(`Autoplay bloqueado por el navegador. El usuario debe presionar play.`);
            });
        }

        // ¡LA MAGIA! El evento 'ended' es 100% fiable.
        audioPlayer.addEventListener('ended', () => {
            log(`Canción ${currentSongIndex + 1} terminada. Reproduciendo siguiente.`);
            const nextIndex = (currentSongIndex + 1) % playlist.length;
            playSong(nextIndex);
        });

        // El primer clic del usuario
        playFirstBtn.addEventListener('click', () => {
            log("PRIMERA INTERACCIÓN DEL USUARIO. ¡Autoplay habilitado!");
            playSong(0);
        });

        log('Script inicializado. Esperando interacción.');
    </script>

</body>
</html>
